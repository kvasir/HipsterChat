<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Hipster Chat settings</title>
		<link rel="stylesheet" href="node_modules/photon/dist/css/photon.css">
		<link rel="stylesheet" href="index.css">
	</head>
	<body>

		<div class="window">
			<header class="toolbar toolbar-header">
				<h1 class="title">Settings</h1>
			</header>
			<div class="window-content">
				<form class="teams">
					<label class="clickable"><input class="show-settings-on-start" type="checkbox"> Show settings on application start</label>
				</form>

			</div>
			<footer class="toolbar toolbar-footer">

				<div class="toolbar-actions">
					<button class="btn btn-default add-team">Add team</button>

					<button class="btn btn-default pull-right cancel-settings">Cancel</button>
					<button class="btn btn-primary pull-right save-settings">Save</button>
				</div>
			</footer>
		</div>

		<script>
			var ipc = require('ipc');
			var list = document.getElementsByClassName('teams')[0];
			var settingsCheckbox = document.getElementsByClassName('show-settings-on-start')[0];

			var saveButton = document.getElementsByClassName('save-settings')[0];
			saveButton.addEventListener('click', function () {
				var teamNames = document.getElementsByClassName('team-name');
				var teams = [];

				for(var i=0; i < teamNames.length; i++) {
					teams.push(teamNames[i].value);
				}
				var settings = {
					teams: teams,
					showSettings: settingsCheckbox.checked
				};
				ipc.send('settings-save', settings);
			});

			var addButton = document.getElementsByClassName('add-team')[0];
			addButton.addEventListener('click', function () {
				list.appendChild(createTeamItem(''));
			});

			var cancelButton = document.getElementsByClassName('cancel-settings')[0];
			cancelButton.addEventListener('click', function () {
				ipc.send('cancel-settings');
			});

			function createTeamItem(value) {
				var item = document.createElement('div');
				item.className = 'form-group'
				var input = document.createElement('input');
				input.type = 'text';
				input.value = value;
				input.className = 'team-name form-control';
				item.appendChild(input);

				return item;
			}

			ipc.on('settings-message', function (settings) {
				settings.teams.forEach(function (team) {
					list.appendChild(createTeamItem(team));
				});
				if(settings.showSettings)
					settingsCheckbox.checked = true;
			});
		</script>
	</body>
</html>
